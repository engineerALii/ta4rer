<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿßŸÑŸÖÿ≠ÿ±ÿ± ÿßŸÑÿ¨ÿßŸÖÿπŸä ÿßŸÑÿ¥ÿßŸÖŸÑ | ÿ∫ŸÑÿßŸÅ + ÿ™ŸÇÿ±Ÿäÿ±</title>
    <style>
        /* =========================================
           1. CORE VARIABLES & RESET
           ========================================= */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.5);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --danger: #ef4444;
            
            /* Fonts */
            --font-sans: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-serif: 'Times New Roman', Times, serif;
            --font-academic: 'Traditional Arabic', 'Simplified Arabic', serif;
            --font-kufi: 'Tahoma', 'Segoe UI', sans-serif;
            --font-digital: 'Courier New', Courier, monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        /* Decorative Background */
        .bg-orb { position: fixed; border-radius: 50%; filter: blur(80px); z-index: -1; opacity: 0.6; }
        .bg-orb-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #bfdbfe; }
        .bg-orb-2 { bottom: -10%; right: -10%; width: 50vw; height: 50vw; background: #ddd6fe; }

        /* =========================================
           2. NAVIGATION
           ========================================= */
        .main-nav {
            display: flex;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            padding: 5px;
            border-radius: 16px;
            box-shadow: var(--glass-shadow);
            margin-bottom: 25px;
            position: sticky;
            top: 10px;
            z-index: 100;
            border: 1px solid var(--glass-border);
        }

        .nav-item {
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            transition: 0.3s;
            display: flex; gap: 8px; align-items: center;
        }
        .nav-item:hover { color: var(--primary-color); background: rgba(37, 99, 235, 0.05); }
        .nav-item.active { background: var(--primary-color); color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }

        /* =========================================
           3. LAYOUT
           ========================================= */
        .app-container { width: 100%; max-width: 1400px; }

        .section-view { display: none; opacity: 0; transform: translateY(10px); transition: 0.4s; }
        .section-view.active { display: flex; opacity: 1; transform: translateY(0); }
        
        #view-cover { gap: 30px; flex-wrap: wrap; }
        #view-editor { flex-direction: column; align-items: center; width: 100%; }

        /* Panels */
        .controls-panel {
            flex: 1; min-width: 320px;
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 20px;
            padding: 25px; box-shadow: var(--glass-shadow); height: fit-content;
        }

        .preview-panel { flex: 2; min-width: 350px; display: flex; justify-content: center; padding-bottom: 50px; }

        /* UI Elements */
        h1 { font-size: 1.5rem; margin-bottom: 20px; color: #0f172a; display: flex; gap: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary); }
        input, select {
            width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #cbd5e1;
            background: rgba(255,255,255,0.9); font-family: inherit; font-size: 0.95rem;
        }
        input:focus, select:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        .btn { border: none; cursor: pointer; border-radius: 8px; font-family: inherit; font-weight: 600; padding: 10px; display: flex; justify-content: center; gap: 8px; transition: 0.2s; }
        .btn-add { background: #f1f5f9; color: var(--primary-color); width: 100%; margin-top: 8px; }
        .btn-remove { background: #fee2e2; color: var(--danger); padding: 8px 12px; }
        .btn-print { background: var(--primary-color); color: white; padding: 14px; width: 100%; margin-top: 25px; font-size: 1.1rem; box-shadow: 0 4px 12px rgba(37,99,235,0.25); }
        .btn-print:hover { background: var(--primary-hover); transform: translateY(-1px); }

        /* =========================================
           4. EDITOR & FONT FIXES
           ========================================= */
        .editor-wrapper { width: 100%; max-width: 210mm; margin: 0 auto; }

        .editor-toolbar {
            background: var(--glass-bg); backdrop-filter: blur(15px);
            padding: 10px; border-radius: 12px; border: 1px solid var(--glass-border);
            display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;
            position: sticky; top: 80px; z-index: 90;
        }

        .tool-group { display: flex; gap: 5px; padding-left: 10px; border-left: 1px solid #e2e8f0; align-items: center; }
        .tool-group:last-child { border: none; }
        .tool-btn { background: transparent; border: 1px solid transparent; border-radius: 6px; padding: 6px 10px; cursor: pointer; font-size: 1rem; }
        .tool-btn:hover { background: rgba(0,0,0,0.05); }

        /* Override browser font sizes to match requirement */
        font[size="3"] { font-size: 12pt !important; }
        font[size="5"] { font-size: 14pt !important; }
        font[size="7"] { font-size: 18pt !important; }

        .editor-paper {
            background: white; width: 100%; min-height: 297mm;
            padding: 25.4mm; /* 1 inch */
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            font-size: 12pt; line-height: 1.6; color: #000;
            direction: rtl; outline: none;
            
            /* --- CRITICAL FIX FOR OVERFLOWING TEXT --- */
            overflow-wrap: break-word;   /* Standard */
            word-wrap: break-word;       /* Legacy */
            word-break: break-word;      /* For very long words */
            white-space: pre-wrap;       /* Preserve lines but wrap text */
        }
        
        /* Prevent Images/Tables from overflowing */
        .editor-paper img,
        .editor-paper table,
        .editor-paper video,
        .editor-paper iframe {
            max-width: 100% !important;
            height: auto !important;
        }

        .page-break-marker {
            border-bottom: 2px dashed #cbd5e1; margin: 20px -25.4mm;
            position: relative; height: 20px; page-break-after: always;
            display: flex; justify-content: center; align-items: center;
            color: #94a3b8; font-size: 0.8rem; pointer-events: none;
        }
        .page-break-marker::after { content: 'ŸÅÿßÿµŸÑ ÿµŸÅÿ≠ÿßÿ™'; background: #f1f5f9; padding: 0 10px; }

        /* =========================================
           5. A4 PREVIEW (Cover)
           ========================================= */
        .a4-wrapper {
            background: white; width: 210mm; min-height: 297mm; padding: 20mm;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); position: relative;
            transform-origin: top center; transition: 0.3s; overflow: hidden; color: #000;
        }

        /* Common Elements */
        .report-header { text-align: center; margin-bottom: 40px; }
        .uni-logo-placeholder { width: 80px; height: 80px; background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2rem; margin: 0 auto 15px; }
        .report-title { font-size: 2.2rem; font-weight: 800; margin: 30px 0; line-height: 1.3; text-align: center; }
        .report-meta { max-width: 80%; margin: 0 auto; text-align: right; border: 1px solid #eee; padding: 20px; }
        .meta-row { display: flex; margin-bottom: 12px; font-size: 1.1rem; }
        .meta-label { font-weight: bold; width: 120px; }

        /* Themes */
        [data-theme="formal"] { border: 1px solid #ccc; }
        [data-theme="formal"] .report-header { border-bottom: 3px double #000; padding-bottom: 20px; }
        [data-theme="formal"] .report-title { text-decoration: underline; text-underline-offset: 8px; }
        [data-theme="formal"] .report-meta { border: 1px solid #000; }

        [data-theme="modern"] .uni-logo-placeholder { background: white; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        [data-theme="modern"]::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 20mm; background: linear-gradient(to right, #2563eb, #60a5fa); }
        [data-theme="modern"] .report-title { color: #2563eb; }

        /* Fonts classes */
        .font-sans { font-family: var(--font-sans) !important; }
        .font-serif { font-family: var(--font-serif) !important; }
        .font-academic { font-family: var(--font-academic) !important; }
        .font-kufi { font-family: var(--font-kufi) !important; }
        .font-digital { font-family: var(--font-digital) !important; }

        /* =========================================
           6. RESPONSIVE & PRINT FIXES
           ========================================= */
        @media (max-width: 900px) {
            #view-cover { flex-direction: column; }
            .preview-panel { display: block; }
            .a4-wrapper { transform: scale(0.42); transform-origin: top center; margin: 0 auto; }
            .editor-wrapper { width: 100%; transform: scale(0.9); transform-origin: top center; }
            .controls-panel { position: static; }
        }

        /* PRINT CONFIGURATION - CRITICAL FIXES */
        @media print {
            @page { size: A4; margin: 0; }
            
            html, body {
                height: auto;
                background: white;
                margin: 0; padding: 0;
                overflow: visible !important;
                display: block;
            }

            /* Hide UI */
            .main-nav, .controls-panel, .editor-toolbar, .btn, .bg-orb, .editor-stats { display: none !important; }
            
            /* Layout Reset */
            .app-container, .preview-panel, .section-view {
                width: 100%; max-width: none; display: block !important; opacity: 1 !important; transform: none !important; margin: 0; padding: 0;
            }

            /* Cover Page */
            #view-cover { display: block !important; page-break-after: always; }
            #a4Page {
                width: 210mm; min-height: 297mm; margin: 0 auto;
                box-shadow: none; border: none; transform: none !important;
                page-break-after: always;
            }

            /* Editor Content */
            #view-editor { display: block !important; }
            .editor-wrapper { width: 100%; max-width: none; margin: 0; transform: none !important; }
            .editor-paper {
                width: 100%; max-width: 210mm; margin: 0 auto;
                padding: 20mm; /* Safe print margin */
                box-shadow: none; border: none;
                overflow: visible !important;
                min-height: auto;
                /* Force wrap on print too */
                overflow-wrap: break-word;
                word-wrap: break-word;
                white-space: pre-wrap;
            }
            .editor-paper * {
                max-width: 100% !important;
            }
            
            /* Ensure page breaks work */
            .page-break-marker { border: none; height: 0; margin: 0; visibility: hidden; page-break-after: always; }
        }
    </style>
</head>
<body>
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>

    <nav class="main-nav">
        <div class="nav-item active" onclick="switchTab('cover')">üé® ÿßŸÑÿ∫ŸÑÿßŸÅ</div>
        <div class="nav-item" onclick="switchTab('editor')">üìù ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±</div>
    </nav>

    <div class="app-container">
        
        <!-- COVER -->
        <section id="view-cover" class="section-view active">
            <aside class="controls-panel">
                <h1>‚öôÔ∏è ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</h1>
                <div class="form-group">
                    <label>ÿßŸÑÿ™ÿµŸÖŸäŸÖ</label>
                    <select id="themeSelect" onchange="updateTheme()">
                        <option value="formal">ÿ±ÿ≥ŸÖŸä ÿ£ŸÉÿßÿØŸäŸÖŸä</option>
                        <option value="modern">ŸÖŸàÿØÿ±ŸÜ</option>
                        <option value="corporate">ÿ¥ÿ±ŸÉÿßÿ™</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ÿßŸÑÿÆÿ∑</label>
                    <select id="fontSelect" onchange="updateFont()">
                        <option value="font-sans">ÿ≠ÿØŸäÿ´</option>
                        <option value="font-serif">ÿ™ŸÇŸÑŸäÿØŸä</option>
                        <option value="font-academic">ÿ£ŸÉÿßÿØŸäŸÖŸä</option>
                    </select>
                </div>
                <!-- Inputs -->
                <div class="form-group"><input type="text" id="uniName" placeholder="ÿßŸÑÿ¨ÿßŸÖÿπÿ©" oninput="updatePreview()"></div>
                <div class="form-group"><input type="text" id="reportTitle" placeholder="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±" oninput="updatePreview()"></div>
                <div class="form-group"><input type="text" id="supervisorName" placeholder="ÿßŸÑŸÖÿ¥ÿ±ŸÅ" oninput="updatePreview()"></div>
                <div class="form-group">
                    <div id="studentsContainer"><input type="text" class="student-input" placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ®" oninput="updatePreview()" value="ÿ∑ÿßŸÑÿ® 1"></div>
                    <button class="btn btn-add" onclick="addStudent()">+ ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ®</button>
                </div>
                <div class="form-group"><input type="text" id="yearText" placeholder="ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ©" oninput="updatePreview()"></div>
            </aside>

            <main class="preview-panel">
                <div id="a4Page" class="a4-wrapper font-sans" data-theme="formal">
                    <div class="report-header">
                        <div class="uni-logo-placeholder">üèõÔ∏è</div>
                        <h2 id="prevUni">ÿßŸÑÿ¨ÿßŸÖÿπÿ©</h2>
                    </div>
                    <div class="report-body">
                        <h1 class="report-title" id="prevTitle">ÿßŸÑÿπŸÜŸàÿßŸÜ</h1>
                        <div class="report-meta">
                            <div class="meta-row"><span class="meta-label">ÿ•ÿ¥ÿ±ÿßŸÅ:</span><span id="prevSupervisor">...</span></div>
                            <div class="meta-row"><span class="meta-label">ÿ•ÿπÿØÿßÿØ:</span><div id="prevStudents">...</div></div>
                            <div class="meta-row"><span class="meta-label">ÿßŸÑÿπÿßŸÖ:</span><span id="prevYear">...</span></div>
                        </div>
                    </div>
                </div>
            </main>
        </section>

        <!-- EDITOR -->
        <section id="view-editor" class="section-view">
            <div class="editor-wrapper">
                <div class="editor-toolbar">
                    <div class="tool-group">
                        <button class="tool-btn" onclick="fmt('justifyRight')">‚û°Ô∏è</button>
                        <button class="tool-btn" onclick="fmt('justifyCenter')">‚ÜîÔ∏è</button>
                        <button class="tool-btn" onclick="fmt('justifyLeft')">‚¨ÖÔ∏è</button>
                    </div>
                    <div class="tool-group">
                        <button class="tool-btn" onclick="fmt('bold')"><b>B</b></button>
                        <button class="tool-btn" onclick="fmt('italic')"><i>I</i></button>
                        <button class="tool-btn" onclick="fmt('underline')"><u>U</u></button>
                    </div>
                    <div class="tool-group">
                        <!-- Using Native Font Sizes 3, 5, 7 mapping to CSS -->
                        <button class="tool-btn" onclick="setSize(3)">S</button>
                        <button class="tool-btn" onclick="setSize(5)">M</button>
                        <button class="tool-btn" onclick="setSize(7)">L</button>
                    </div>
                    <div class="tool-group">
                        <button class="tool-btn" onclick="insertBreak()">üìÑ ŸÅÿßÿµŸÑ</button>
                        <button class="tool-btn" onclick="fmt('removeFormat')">üßπ</button>
                    </div>
                </div>

                <div id="reportHeader" style="display:none; justify-content:space-between; padding:10px; border-bottom:1px solid #ccc; width:100%;">
                    <span id="headerTitle">ÿßŸÑÿπŸÜŸàÿßŸÜ</span><span id="headerName">ÿßŸÑÿ∑ÿßŸÑÿ®</span>
                </div>

                <div id="reportEditor" class="editor-paper font-sans" contenteditable="true" oninput="save()"></div>
                
                <div class="editor-stats"><span id="wordCount">0 ŸÉŸÑŸÖÿ©</span></div>
                
                <button class="btn btn-print" onclick="window.print()">ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑŸÖŸÑŸÅ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ üñ®Ô∏è</button>
            </div>
        </section>

    </div>

    <script>
        // DOM Elements
        const a4 = document.getElementById('a4Page');
        const editor = document.getElementById('reportEditor');

        // Tabs
        function switchTab(tab) {
            document.querySelectorAll('.section-view').forEach(e => e.classList.remove('active'));
            document.getElementById('view-' + tab).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            if(tab === 'editor') syncHeader();
        }

        // Cover Logic
        function updateTheme() { a4.setAttribute('data-theme', document.getElementById('themeSelect').value); }
        function updateFont() { 
            const f = document.getElementById('fontSelect').value;
            a4.className = `a4-wrapper ${f}`;
            editor.className = `editor-paper ${f}`;
        }
        function addStudent() {
            const d = document.createElement('div');
            d.innerHTML = `<input class="student-input" style="margin-top:5px" placeholder="ÿ∑ÿßŸÑÿ® ÿ¢ÿÆÿ±" oninput="updatePreview()">`;
            document.getElementById('studentsContainer').appendChild(d);
        }
        function updatePreview() {
            document.getElementById('prevUni').textContent = document.getElementById('uniName').value || 'ÿßŸÑÿ¨ÿßŸÖÿπÿ©';
            document.getElementById('prevTitle').textContent = document.getElementById('reportTitle').value || 'ÿßŸÑÿπŸÜŸàÿßŸÜ';
            document.getElementById('prevSupervisor').textContent = document.getElementById('supervisorName').value || '...';
            document.getElementById('prevYear').textContent = document.getElementById('yearText').value || '...';
            
            const stds = document.querySelectorAll('.student-input');
            const list = document.getElementById('prevStudents');
            list.innerHTML = '';
            stds.forEach(s => { if(s.value) list.innerHTML += `<div>${s.value}</div>`; });
            syncHeader();
        }

        // Editor Logic - Using Native Commands for Stability
        function fmt(cmd, val=null) { 
            document.execCommand(cmd, false, val); 
            editor.focus(); 
        }
        
        // Robust Size Changing
        function setSize(size) {
            // This uses <font size="X"> which we style via CSS
            document.execCommand('fontSize', false, size);
            editor.focus();
        }

        function insertBreak() {
            // Insert a marker that acts as page break
            const html = `<div class="page-break-marker" contenteditable="false"></div><br>`;
            document.execCommand('insertHTML', false, html);
        }

        function save() {
            localStorage.setItem('content', editor.innerHTML);
            const w = editor.innerText.trim().split(/\s+/).length;
            document.getElementById('wordCount').textContent = (editor.innerText ? w : 0) + ' ŸÉŸÑŸÖÿ©';
        }

        function syncHeader() {
            document.getElementById('headerTitle').textContent = document.getElementById('reportTitle').value;
            const f = document.querySelector('.student-input');
            document.getElementById('headerName').textContent = f ? f.value : '';
        }

        // Init
        window.onload = () => {
            if(localStorage.getItem('content')) editor.innerHTML = localStorage.getItem('content');
            updatePreview();
        };
    </script>
</body>
</html>
