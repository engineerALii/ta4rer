<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿ™ŸÇÿ±Ÿäÿ±Ÿä ÿ®ÿ±Ÿà</title>
    
    <!-- iOS Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÿ™ŸÇÿ±Ÿäÿ±Ÿä ÿ®ÿ±Ÿà">

    <!-- Site Icons -->
    <link rel="icon" href="https://logo-icons.com/cdn/shop/files/201-logo-1712247205.834color-A52A2A.svg?v=1712759420&width=416" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://logo-icons.com/cdn/shop/files/201-logo-1712247205.834color-A52A2A.svg?v=1712759420&width=416">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@400;600;700&family=Poppins:wght@400;600&family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           0. GLOBAL PRINT SETTINGS
           ========================================= */
        @page {
            size: A4;
            margin: 0 !important;
        }

        /* =========================================
           1. iOS THEME VARIABLES
           ========================================= */
        :root {
            --ios-bg: #000000;
            --ios-card: #1c1c1e;
            --ios-card-border: rgba(255, 255, 255, 0.12);
            --ios-primary: #0A84FF;
            --ios-text: #FFFFFF;
            --ios-text-secondary: #8E8E93;
            --ios-separator: #38383a;
            --ios-danger: #FF453A;
            --ios-success: #30D158;
            
            --radius-l: 20px;
            --radius-m: 12px;
            
            /* Fonts */
            --font-main: -apple-system, BlinkMacSystemFont, 'Tajawal', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: var(--font-main);
            background-color: var(--ios-bg);
            color: var(--ios-text);
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden; 
        }

        /* App Container */
        .ios-app {
            width: 100%;
            max-width: 600px;
            height: 100vh;
            background: var(--ios-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* =========================================
           2. HEADER & NAVIGATION
           ========================================= */
        .ios-header {
            padding: 40px 20px 10px; /* Reduced top padding slightly */
            background: rgba(28, 28, 30, 1); /* Solid background for top */
            border-bottom: none; /* Removed border as tabs will have it */
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        /* Modern Clear Title Style */
        .ios-title { 
            font-family: 'Tajawal', sans-serif; /* Clean, modern Arabic font */
            font-size: 34px; 
            font-weight: 900; /* Ultra bold for impact */
            letter-spacing: -0.5px;
            
            /* Elegant Gradient Text */
            background: linear-gradient(135deg, #ffffff 30%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            
            /* Soft glow instead of hard shadow */
            text-shadow: 0 2px 20px rgba(59, 130, 246, 0.2);
        }

        .ios-subtitle { font-size: 13px; color: var(--ios-text-secondary); font-weight: 600; text-transform: uppercase; margin-bottom: -2px;}

        /* Tab Bar - MOVED TO TOP STYLE */
        .ios-tab-bar {
            position: relative; /* Changed from absolute bottom */
            height: auto;
            background: rgba(28, 28, 30, 1);
            border-bottom: 0.5px solid var(--ios-separator); /* Border at bottom now */
            border-top: none;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 200;
            flex-shrink: 0;
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--ios-text-secondary);
            font-size: 11px; /* Slightly larger text for top tabs */
            gap: 5px;
            width: 100%;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .tab-item.active { color: var(--ios-primary); }
        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: -11px; /* Line at the very bottom edge */
            left: 20%;
            width: 60%;
            height: 3px;
            background: var(--ios-primary);
            border-radius: 3px 3px 0 0;
        }
        .tab-icon { font-size: 22px; }

        /* Content Scroll Area */
        .ios-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            padding-bottom: 40px; /* Reduced bottom padding since no tab bar there */
            scroll-behavior: smooth;
        }

        /* =========================================
           3. UI COMPONENTS
           ========================================= */
        .ios-list-group {
            background: var(--ios-card);
            border-radius: var(--radius-m);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .ios-list-header {
            padding: 0 15px 8px;
            font-size: 13px;
            color: var(--ios-text-secondary);
            text-transform: uppercase;
            font-weight: 600;
        }

        .ios-list-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: var(--ios-card);
            border-bottom: 0.5px solid var(--ios-separator);
            min-height: 44px;
        }
        .ios-list-item:last-child { border-bottom: none; }

        .item-label { width: 100px; font-size: 16px; font-weight: 500; }
        
        .item-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--ios-primary);
            font-size: 16px;
            text-align: left;
            font-family: inherit;
        }
        .item-input::placeholder { color: var(--ios-text-secondary); opacity: 0.5; }
        
        .item-select {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--ios-primary);
            font-size: 16px;
            direction: ltr;
            appearance: none;
            text-align: right;
        }

        .ios-btn {
            background: var(--ios-card);
            color: var(--ios-primary);
            border: none;
            border-radius: var(--radius-m);
            padding: 14px;
            font-size: 17px;
            font-weight: 600;
            width: 100%;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .ios-btn:active { background: rgba(255,255,255,0.1); }
        .btn-primary { background: var(--ios-primary); color: white; }
        .btn-danger { color: var(--ios-danger); }

        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        .file-upload-wrapper input[type=file] {
            position: absolute; left: 0; top: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer;
        }

        .view-section { display: none; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* =========================================
           4. PREVIEW & EDITOR
           ========================================= */
        .preview-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: hidden;
            margin-top: 10px;
            transition: height 0.3s ease;
        }

        /* Wrapper for A4 page */
        .a4-wrapper {
            width: 210mm;
            height: 297mm;
            background: white;
            color: black;
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transform-origin: top center;
            padding: 20mm;
            overflow: hidden; 
            z-index: 1;
        }

        /* --- IMAGE HANDLING --- */
        #coverImgDisplay {
            position: absolute;
            top: 0; 
            left: 0;
            width: 100%; 
            height: 100%;
            object-fit: contain; 
            background-color: white; 
            z-index: 5;
            display: none; 
            margin: 0;
            padding: 0;
            border: none;
        }

        .a4-wrapper.has-image .report-content-wrapper { display: none !important; }
        .a4-wrapper.has-image #coverImgDisplay { display: block !important; }
        .a4-wrapper.has-image { padding: 0 !important; background-color: white !important; }

        /* Editor Paper */
        .editor-paper {
            background: white; 
            width: 100%; 
            min-height: 297mm;
            padding: 25.4mm;
            color: black;
            font-size: 14pt;
            line-height: 1.6;
            outline: none;
            border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            overflow-wrap: break-word;
        }
        .editor-paper:focus { box-shadow: 0 0 0 4px rgba(10, 132, 255, 0.5); }

        /* --- PAGE BREAK MARKER STYLES (NEW) --- */
        .page-break-marker {
            margin: 20px 0;
            height: 2px;
            background: repeating-linear-gradient(90deg, #94a3b8 0, #94a3b8 5px, transparent 5px, transparent 10px);
            position: relative;
            cursor: default;
            user-select: none;
        }

        .page-break-marker::after {
            content: "‚úÇÔ∏è ŸÅÿßÿµŸÑ ÿµŸÅÿ≠ÿßÿ™";
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 0 10px;
            color: #64748b;
            font-size: 12px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        /* Toolbar */
        .editor-toolbar {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 10px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .editor-toolbar::-webkit-scrollbar { display: none; }

        .toolbar-btn {
            background: var(--ios-card);
            border: 1px solid var(--ios-card-border);
            color: var(--ios-text);
            min-width: 44px; height: 44px;
            border-radius: 10px;
            font-size: 18px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.1s;
        }
        .toolbar-btn:active { background: var(--ios-primary); color: white; }
        .toolbar-btn svg { width: 20px; height: 20px; fill: currentColor; }

        .ios-credits {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--ios-text-secondary);
            font-size: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }
        .credits-icon svg { width: 20px; fill: #E1306C; }

        /* =========================================
           5. THEMES & CONTENT
           ========================================= */
        [data-theme="formal"] { border: 1px solid #ddd; }
        [data-theme="formal"] .report-header { text-align: center; border-bottom: 3px double #000; padding-bottom: 20px; margin-bottom: 40px; }
        [data-theme="modern"]::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 15mm; background: linear-gradient(90deg, #0A84FF, #5E5CE6); }
        
        .report-header { text-align: center; margin-bottom: 40px; }
        .uni-logo-placeholder { width: 80px; height: 80px; background: #f2f2f7; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 15px; }
        .report-title { font-size: 2.2rem; font-weight: 800; text-align: center; margin: 30px 0; }
        .report-meta { text-align: right; border: 1px solid #ccc; padding: 20px; width: 80%; margin: 0 auto; }
        .meta-row { display: flex; margin-bottom: 10px; font-size: 1.1rem; }
        .meta-label { font-weight: bold; width: 120px; }

        /* Fonts */
        .font-tajawal { font-family: 'Tajawal', sans-serif !important; }
        .font-cairo { font-family: 'Cairo', sans-serif !important; }
        .font-amiri { font-family: 'Amiri', serif !important; }
        .font-poppins { font-family: 'Poppins', sans-serif !important; }

        /* =========================================
           6. PRINT STYLES (THE FIX)
           ========================================= */
        @media print {
            /* Reset root */
            html, body { 
                margin: 0 !important; 
                padding: 0 !important; 
                width: 100% !important;
                height: 100% !important;
                background: white !important;
                display: block !important;
                overflow: visible !important;
            }
            
            .ios-app {
                width: 100% !important;
                max-width: none !important;
                height: auto !important;
                background: white !important;
                box-shadow: none !important;
                position: static !important;
                display: block !important;
                overflow: visible !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* Hide UI */
            .ios-header, .ios-tab-bar, .editor-toolbar, .ios-credits, 
            #view-settings, .ios-list-header, .btn-primary, .preview-container button { 
                display: none !important; 
            }

            /* Content Reset */
            .ios-content {
                display: block !important;
                padding: 0 !important;
                margin: 0 !important;
                height: auto !important;
                overflow: visible !important;
                width: 100% !important;
            }

            /* Visible Sections */
            #view-cover, #view-editor {
                display: block !important;
                opacity: 1 !important;
                transform: none !important;
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                overflow: visible !important;
                height: auto !important;
            }

            #view-cover { page-break-after: always; }
            .preview-container { display: block !important; margin: 0 !important; padding: 0 !important; height: auto !important; }

            /* A4 Wrapper - USE PERCENTAGE FOR PHONE COMPATIBILITY */
            .a4-wrapper { 
                width: 100% !important; /* Adapt to printer width */
                max-width: 210mm !important; /* Cap at A4 */
                height: auto !important; /* Let height flow naturally for text */
                min-height: 290mm !important; /* Almost A4 height */
                margin: 0 auto !important;
                padding: 20mm !important;
                box-shadow: none !important; 
                border: none !important;
                transform: none !important; 
                overflow: hidden !important; 
                position: relative !important;
                page-break-after: always;
                page-break-inside: avoid;
            }

            /* IMAGE FIX FOR PHONES: Use 100% Dimensions */
            .a4-wrapper.has-image {
                padding: 0 !important;
                background: none !important;
                height: 100% !important; /* Fill page */
                min-height: 100% !important;
            }
            
            #coverImgDisplay { display: none; }
            
            .a4-wrapper.has-image #coverImgDisplay {
                display: block !important;
                position: relative !important; /* Flow naturally */
                width: 100% !important; /* Fill width */
                height: auto !important; /* Maintain aspect ratio or fill */
                max-height: 100% !important; /* Don't exceed page */
                object-fit: contain !important;
                z-index: 5;
            }

            .editor-paper {
                width: 100% !important;
                max-width: 210mm !important;
                margin: 0 auto !important;
                padding: 25.4mm !important;
                box-shadow: none !important;
                border: none !important;
                overflow: visible !important;
            }

            /* --- PRINT PAGE BREAK FIX --- */
            .page-break-marker {
                background: none !important;
                border: none !important;
                height: 0 !important;
                margin: 0 !important;
                visibility: hidden !important;
                /* Modern syntax */
                break-after: page !important;
                /* Legacy syntax */
                page-break-after: always !important;
                display: block !important; /* Essential */
            }
            
            .page-break-marker::after {
                display: none !important;
            }

            * { color: black !important; text-shadow: none !important; }
        }
    </style>
</head>
<body>

    <div class="ios-app">
        <!-- Header -->
        <header class="ios-header">
            <div>
                <div class="ios-subtitle">2026 Edition</div>
                <div class="ios-title">ÿ™ŸÇÿ±Ÿäÿ±Ÿä ÿ®ÿ±Ÿà</div>
            </div>
            <!-- Replaced Emoji with Logo Image -->
            <img src="https://logo-icons.com/cdn/shop/files/201-logo-1712247205.834color-A52A2A.svg?v=1712759420&width=416" alt="Logo" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
        </header>

        <!-- Tab Bar Navigation (Moved to Top) -->
        <nav class="ios-tab-bar">
            <div class="tab-item active" onclick="switchView('settings', this)">
                <div class="tab-icon">‚öôÔ∏è</div><span>ÿ•ÿπÿØÿßÿØÿßÿ™</span>
            </div>
            <div class="tab-item" onclick="switchView('cover', this)">
                <div class="tab-icon">üìÑ</div><span>ÿßŸÑÿ∫ŸÑÿßŸÅ</span>
            </div>
            <div class="tab-item" onclick="switchView('editor', this)">
                <div class="tab-icon">üìù</div><span>ŸÉÿ™ÿßÿ®ÿ©</span>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="ios-content">
            
            <!-- VIEW 1: SETTINGS -->
            <div id="view-settings" class="view-section active">
                
                <div class="ios-list-header">ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∫ŸÑÿßŸÅ</div>
                <div class="ios-list-group">
                    <div class="ios-list-item">
                        <label class="item-label">ÿßŸÑÿ¨ÿßŸÖÿπÿ©</label>
                        <input type="text" class="item-input" id="uniName" placeholder="ÿßŸÉÿ™ÿ® ÿßŸÑÿßÿ≥ŸÖ..." oninput="updatePreview()">
                    </div>
                    <div class="ios-list-item">
                        <label class="item-label">ÿßŸÑÿπŸÜŸàÿßŸÜ</label>
                        <input type="text" class="item-input" id="reportTitle" placeholder="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ®ÿ≠ÿ´..." oninput="updatePreview()">
                    </div>
                    <div class="ios-list-item">
                        <label class="item-label">ÿßŸÑŸÖÿ¥ÿ±ŸÅ</label>
                        <input type="text" class="item-input" id="supervisorName" placeholder="ÿØ. ÿßŸÑÿßÿ≥ŸÖ..." oninput="updatePreview()">
                    </div>
                    <div class="ios-list-item">
                        <label class="item-label">ÿßŸÑÿ≥ŸÜÿ©</label>
                        <input type="text" class="item-input" id="yearText" placeholder="2025-2026" oninput="updatePreview()">
                    </div>
                </div>

                <div class="ios-list-header">ÿßŸÑÿ∑ŸÑÿßÿ®</div>
                <div class="ios-list-group" id="studentsList">
                    <div class="ios-list-item">
                        <input type="text" class="item-input student-input" placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® 1" oninput="updatePreview()" value="ÿ∑ÿßŸÑÿ® 1">
                    </div>
                </div>
                <button class="ios-btn" onclick="addStudent()">
                    <span style="font-size:20px">+</span> ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ÿßŸÑÿ®
                </button>

                <div class="ios-list-header">ÿßŸÑÿ™ÿÆÿµŸäÿµ</div>
                <div class="ios-list-group">
                    <div class="ios-list-item">
                        <label class="item-label">ÿµŸàÿ±ÿ© ÿ∫ŸÑÿßŸÅ</label>
                        <div class="file-upload-wrapper item-input">
                            <span style="color:var(--ios-primary)">ÿßÿÆÿ™ÿ± ÿµŸàÿ±ÿ©...</span>
                            <input type="file" id="coverImageInput" accept="image/*" onchange="handleCoverImage(this)">
                        </div>
                        <button onclick="removeCoverImage()" style="background:none; border:none; color:var(--ios-danger); display:none;" id="removeImgBtn">‚úï</button>
                    </div>
                    <div class="ios-list-item">
                        <label class="item-label">ÿßŸÑÿÆÿ∑</label>
                        <select id="fontSelect" class="item-select" onchange="updateFont()">
                            <option value="font-tajawal">Tajawal</option>
                            <option value="font-cairo">Cairo</option>
                            <option value="font-amiri">Amiri</option>
                            <option value="font-poppins">Poppins</option>
                        </select>
                    </div>
                    <div class="ios-list-item">
                        <label class="item-label">ÿßŸÑÿ™ÿµŸÖŸäŸÖ</label>
                        <select id="themeSelect" class="item-select" onchange="updateTheme()">
                            <option value="formal">ÿ±ÿ≥ŸÖŸä</option>
                            <option value="modern">ŸÖŸàÿØÿ±ŸÜ</option>
                            <option value="corporate">ÿ¥ÿ±ŸÉÿßÿ™</option>
                        </select>
                    </div>
                </div>

                <a href="https://instagram.com/c4man" target="_blank" class="ios-credits">
                    <div class="credits-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.5 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
                    </div>
                    <span>Design by Ali Abdulmuslim ¬© 2026</span>
                </a>
            </div>

            <!-- VIEW 2: COVER PREVIEW -->
            <div id="view-cover" class="view-section">
                <div class="ios-list-header" style="text-align:center; margin-bottom:10px;">ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ∫ŸÑÿßŸÅ (A4)</div>
                <div class="preview-container" id="previewContainer">
                    <div id="a4Page" class="a4-wrapper font-tajawal" data-theme="formal">
                        <!-- NEW: Real Image Element for printing support -->
                        <img id="coverImgDisplay" src="" alt="Cover Image">
                        
                        <div class="report-content-wrapper">
                            <div class="report-header">
                                <div class="uni-logo-placeholder">üèõÔ∏è</div>
                                <h2 id="prevUni">ÿßŸÑÿ¨ÿßŸÖÿπÿ©</h2>
                            </div>
                            <div class="report-body">
                                <h1 class="report-title" id="prevTitle">ÿßŸÑÿπŸÜŸàÿßŸÜ</h1>
                                <div class="report-meta">
                                    <div class="meta-row"><span class="meta-label">ÿ•ÿ¥ÿ±ÿßŸÅ:</span><span id="prevSupervisor">...</span></div>
                                    <div class="meta-row"><span class="meta-label">ÿ•ÿπÿØÿßÿØ:</span><div id="prevStudents">...</div></div>
                                    <div class="meta-row"><span class="meta-label">ÿßŸÑÿπÿßŸÖ:</span><span id="prevYear">...</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="ios-btn btn-primary" style="margin-top:20px" onclick="window.print()">ÿ∑ÿ®ÿßÿπÿ© / ÿ≠ŸÅÿ∏ PDF üñ®Ô∏è</button>
            </div>

            <!-- VIEW 3: REPORT EDITOR -->
            <div id="view-editor" class="view-section">
                <div class="editor-toolbar">
                    <button class="toolbar-btn" onclick="fmt('bold')" title="ÿπÿ±Ÿäÿ∂"><b>B</b></button>
                    <button class="toolbar-btn" onclick="fmt('italic')" title="ŸÖÿßÿ¶ŸÑ"><i>I</i></button>
                    <button class="toolbar-btn" onclick="fmt('underline')" title="ÿ™ÿ≥ÿ∑Ÿäÿ±"><u>U</u></button>
                    
                    <div style="width:1px; background:var(--ios-separator); margin:0 5px;"></div>
                    
                    <button class="toolbar-btn" onclick="fmt('justifyRight')" title="ŸäŸÖŸäŸÜ">
                        <svg viewBox="0 0 24 24"><path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/></svg>
                    </button>
                    <button class="toolbar-btn" onclick="fmt('justifyCenter')" title="Ÿàÿ≥ÿ∑">
                        <svg viewBox="0 0 24 24"><path d="M7 21h10v-2H7v2zM3 17h18v-2H3v2zm4-4h10v-2H7v2zM3 9h18V7H3v2zm4-4h10V3H7v2z"/></svg>
                    </button>
                    <button class="toolbar-btn" onclick="fmt('justifyLeft')" title="Ÿäÿ≥ÿßÿ±">
                        <svg viewBox="0 0 24 24"><path d="M3 21h18v-2H3v2zm0-4h12v-2H3v2zm0-4h18v-2H3v2zm0-4h12V7H3v2zm0-6v2h18V3H3z"/></svg>
                    </button>

                    <div style="width:1px; background:var(--ios-separator); margin:0 5px;"></div>

                    <button class="toolbar-btn" onclick="setSize(5)" title="ÿ™ŸÉÿ®Ÿäÿ± ÿßŸÑÿÆÿ∑">A+</button>
                    <button class="toolbar-btn" onclick="setSize(3)" title="ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿÆÿ∑">A-</button>
                    <button class="toolbar-btn" onclick="insertBreak()" title="ŸÅÿßÿµŸÑ ÿµŸÅÿ≠ÿßÿ™">üìÑ</button>
                </div>
                
                <div style="background:#f2f2f7; padding:10px; border-radius:10px; overflow:hidden;">
                    <div id="reportEditor" class="editor-paper font-tajawal" contenteditable="true" dir="auto" oninput="save()"></div>
                </div>
                <div class="ios-list-header" style="margin-top:5px;">ÿπÿØÿØ ÿßŸÑŸÉŸÑŸÖÿßÿ™: <span id="wordCount">0</span></div>
            </div>

        </main>
    </div>

    <script>
        // --- Navigation ---
        function switchView(viewId, el) {
            document.querySelectorAll('.view-section').forEach(d => d.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            if(el) el.classList.add('active');
            if(viewId === 'cover') fitPreview();
        }

        function fitPreview() {
            const wrapper = document.getElementById('a4Page');
            const container = document.getElementById('previewContainer');
            const width = container.offsetWidth;
            const a4PixelWidth = 794; 
            const scaleRatio = (width - 40) / a4PixelWidth;
            if(width < a4PixelWidth) {
                wrapper.style.transform = `scale(${scaleRatio})`;
                wrapper.style.marginBottom = `-${(1 - scaleRatio) * 1123}px`;
            } else {
                wrapper.style.transform = 'scale(1)';
                wrapper.style.marginBottom = '0';
            }
        }
        window.addEventListener('resize', fitPreview);

        // --- Logic ---
        const a4 = document.getElementById('a4Page');
        const editor = document.getElementById('reportEditor');
        const coverImgDisplay = document.getElementById('coverImgDisplay');

        function updateTheme() { a4.setAttribute('data-theme', document.getElementById('themeSelect').value); }
        
        function updateFont() { 
            const f = document.getElementById('fontSelect').value;
            a4.className = `a4-wrapper ${f}`;
            if(coverImgDisplay.src) a4.classList.add('has-image');
            editor.className = `editor-paper ${f}`;
        }

        function handleCoverImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    coverImgDisplay.src = e.target.result;
                    a4.classList.add('has-image');
                    document.getElementById('removeImgBtn').style.display = 'inline-block';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeCoverImage() {
            coverImgDisplay.src = '';
            a4.classList.remove('has-image');
            document.getElementById('coverImageInput').value = '';
            document.getElementById('removeImgBtn').style.display = 'none';
        }

        function addStudent() {
            const div = document.createElement('div');
            div.className = 'ios-list-item';
            div.innerHTML = `<input type="text" class="item-input student-input" placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ®" oninput="updatePreview()">`;
            document.getElementById('studentsList').appendChild(div);
        }

        function updatePreview() {
            document.getElementById('prevUni').textContent = document.getElementById('uniName').value || 'ÿßŸÑÿ¨ÿßŸÖÿπÿ©';
            document.getElementById('prevTitle').textContent = document.getElementById('reportTitle').value || 'ÿßŸÑÿπŸÜŸàÿßŸÜ';
            document.getElementById('prevSupervisor').textContent = document.getElementById('supervisorName').value || '...';
            document.getElementById('prevYear').textContent = document.getElementById('yearText').value || '...';
            
            const stds = document.querySelectorAll('.student-input');
            const list = document.getElementById('prevStudents');
            list.innerHTML = '';
            stds.forEach(s => { if(s.value) list.innerHTML += `<div>${s.value}</div>`; });
        }

        function fmt(cmd, val=null) { document.execCommand(cmd, false, val); editor.focus(); }
        function setSize(s) { document.execCommand('fontSize', false, s); editor.focus(); }
        // Important change: Use a block div with specific class for page break to work reliably
        function insertBreak() { 
            const breakHtml = '<div class="page-break-marker" contenteditable="false"></div><br>';
            document.execCommand('insertHTML', false, breakHtml); 
        }
        
        function save() {
            localStorage.setItem('content', editor.innerHTML);
            document.getElementById('wordCount').textContent = editor.innerText.trim().split(/\s+/).length;
        }

        window.onload = () => {
            if(localStorage.getItem('content')) editor.innerHTML = localStorage.getItem('content');
            updatePreview();
            fitPreview();
        };

        // --- Hide Browser Title/Url on Print ---
        window.onbeforeprint = function() {
            document.title = "";
        };
        window.onafterprint = function() {
            document.title = "Report Builder iOS";
        };
    </script>
</body>
</html>
